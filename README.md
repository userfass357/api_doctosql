# API DocToSQL

## Описание

Это простое FastAPI-приложение для загрузки документов (например, `.docx` и `.txt`), извлечения текста и хранения их содержимого в базе данных SQLite. Также реализована возможность скачивания сохранённых документов в виде текстовых файлов.

---

## Возможности

- Загрузка документов через API (`/upload/`)
- Извлечение текста из `.docx` и текстовых файлов
- Хранение имени файла и текста в базе данных SQLite
- Получение списка всех документов (`/documents/`)
- Скачивание документа по id (`/?id=1`)

---

## Быстрый старт

### 1. Клонируйте репозиторий и перейдите в папку проекта

```sh
git clone <URL>
cd api_doctosql
```

### 2. Установите зависимости

```sh
pip install fastapi uvicorn sqlalchemy python-docx
```

### 3. Запустите сервер

```sh
python main.py
```
или
```sh
uvicorn main:app --reload
```

---

## Использование

### Загрузка документа

- Эндпоинт: `POST /upload/`
- Используйте Swagger UI: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)
- Или пример на Python:
    ```python
    import requests

    url = "http://127.0.0.1:8000/upload/"
    file_path = "путь_к_файлу.docx"

    with open(file_path, "rb") as f:
        files = {"file": (file_path, f, "application/octet-stream")}
        response = requests.post(url, files=files)

    print(response.json())
    ```

### Получение всех документов

- Эндпоинт: `GET /documents/`
- Возвращает список всех документов с их содержимым.

### Скачивание документа

- Эндпоинт: `GET /?id=1`
- Скачивает файл с именем и содержимым документа по его id.

---

## Структура проекта

```
api_doctosql/
├── main.py
├── database.py
├── models.py
├── parser.py
├── test.py
└── README.md
```

---

## Зависимости

- fastapi
- uvicorn
- sqlalchemy
- python-docx
- requests (для тестирования загрузки)

---

## Примечания

- Все загруженные документы сохраняются в базе данных SQLite (`test_db.sqlite3`).
- Текст извлекается только из параграфов `.docx` и текстовых файлов. Изображения и таблицы не сохраняются.
- Для корректной работы с русскими именами файлов используется кодировка заголовков по RFC 5987.

---
